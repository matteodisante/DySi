# Competition Rocket Configuration Example
# This configuration demonstrates air brakes for apogee targeting

rocket:
  name: "Competition Rocket with Air Brakes"
  dry_mass_kg: 16.5

  inertia:
    ixx_kg_m2: 7.2
    iyy_kg_m2: 7.2
    izz_kg_m2: 0.045

  geometry:
    caliber_m: 0.140  # 140mm diameter
    length_m: 2.2

  cg_location_m: 1.35  # From nose
  cp_location_m: 1.55  # From nose

  nose_cone:
    length_m: 0.55
    kind: "vonKarman"  # Lowest drag
    position_m: 0.0

  fins:
    count: 4
    root_chord_m: 0.140
    tip_chord_m: 0.060
    span_m: 0.120
    thickness_m: 0.004
    position_m: 1.90
    cant_angle_deg: 0.0
    airfoil: null

  parachute:
    enabled: true
    name: "Main"
    cd_s: 12.0
    trigger: "apogee"
    sampling_rate_hz: 105.0
    lag_s: 1.5
    noise_std: [0.0, 0.0, 0.0]

  # Air brakes configuration for apogee targeting
  air_brakes:
    enabled: true
    drag_coefficient_curve: null  # Optional: path to Cd(deployment, Mach) CSV file
    drag_coefficient: 1.8  # Drag coefficient when fully deployed (if no curve)
    reference_area_m2: 0.012  # 12 cm² brake area
    position_m: -0.6  # Position from nose (negative = from tail)
    deployment_level: 0.0  # Initial deployment (0.0 = retracted, controller will adjust)
    override_cd_s: null  # Optional: override cd*area calculation

    # Controller configuration (PID control for apogee targeting)
    controller:
      algorithm: "pid"  # Options: pid, bang_bang, model_predictive
      target_apogee_m: 3000.0  # Target apogee altitude (m)

      # PID gains (tuned for typical competition rocket)
      kp: 0.001  # Proportional gain
      ki: 0.0001  # Integral gain (anti-windup included)
      kd: 0.01  # Derivative gain

      # Hardware constraints (realistic values)
      sampling_rate_hz: 20.0  # Controller update frequency (20 Hz = 50ms)
      computation_time_s: 0.005  # Microcontroller computation delay (5ms)
      actuator_lag_s: 0.050  # Servo motor lag time constant (50ms first-order)
      max_deployment_rate: 2.0  # Maximum deployment speed (1/s, 0 to 1 in 0.5s)

      # Safety interlocks
      min_activation_time_s: 3.5  # Don't deploy before motor burnout (s)
      min_activation_altitude_m: 500.0  # Minimum safe altitude for deployment (m)

  power_off_drag: null
  power_on_drag: null
  coordinate_system: "tail_to_nose"

motor:
  type: "SolidMotor"
  thrust_source: "data/motors/Cesaroni_5880M1160-P.eng"
  dry_mass_kg: 1.815
  dry_inertia: [0.125, 0.125, 0.002]
  nozzle_radius_m: 0.033
  grain_number: 5
  grain_density_kg_m3: 1815.0
  grain_outer_radius_m: 0.033
  grain_initial_inner_radius_m: 0.015
  grain_initial_height_m: 0.120
  grain_separation_m: 0.005
  grains_center_of_mass_position_m: -0.85
  center_of_dry_mass_position_m: 0.317
  nozzle_position_m: 0.0
  burn_time_s: null
  throat_radius_m: 0.011
  position_m: -1.45

environment:
  latitude_deg: 39.3897  # Alcochete, Portugal
  longitude_deg: -8.2889
  elevation_m: 100.0
  atmospheric_model: "standard_atmosphere"
  atmospheric_model_file: null
  date: [2024, 7, 15, 12]  # July 15, 2024, 12:00 UTC

  wind:
    model: "constant"
    velocity_ms: 4.0
    direction_deg: 90.0  # From East

  gravity_ms2: 9.80665
  max_expected_height_m: 4000.0

simulation:
  max_time_s: 600.0
  max_time_step_s: .inf
  min_time_step_s: 0.0
  rtol: 1.0e-6
  atol: 1.0e-6
  terminate_on_apogee: false
  verbose: false

  rail:
    length_m: 5.5
    inclination_deg: 85.0
    heading_deg: 0.0  # North

# Monte Carlo configuration for uncertainty quantification
monte_carlo:
  num_simulations: 100
  seed: 42

  variations:
    motor_thrust_std_pct: 5.0  # ±5% thrust variation
    dry_mass_std_kg: 0.5  # ±0.5 kg mass uncertainty
    wind_speed_std_ms: 2.0  # ±2 m/s wind variation
    cg_location_std_m: 0.03  # ±3 cm CG variation
    air_brakes_deployment_std: 0.05  # ±5% deployment uncertainty
