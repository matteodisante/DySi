# Complete Rocket Simulation Configuration Example
# This file demonstrates all available configuration options

rocket:
  name: "Hermes"
  dry_mass_kg: 16.426

  inertia:
    ixx_kg_m2: 6.321
    iyy_kg_m2: 6.321
    izz_kg_m2: 0.034

  geometry:
    caliber_m: 0.127  # diameter
    length_m: 2.0   # total length

  cg_location_m: 1.255  # Center of gravity from nose (without motor)
  cp_location_m: null # Center of pressure from nose (will be computed if omitted)

  coordinate_system: "nose_to_tail"  # ✅ Origine al NASO, positivo verso CODA

  nose_cone:
    length_m: 0.5
    kind: "vonKarman"  # Options: vonKarman, conical, ogive, elliptical
    position_m: 0.0  # ✅ Position at nose (0.0 m from nose)

  fins:
    count: 4  # ✅ FIXED: 4 pinne per stabilità! (margine statico positivo ~2.0 cal)
    root_chord_m: 0.120
    tip_chord_m: 0.060
    span_m: 0.100
    thickness_m: 0.003
    position_m: 1.95  # ✅ Leading edge a 1.95 m dal naso (5 cm dalla coda, vicino alla tail)
    cant_angle_deg: 0.0  # Cant angle for spin stabilization
    airfoil: null  # Path to airfoil file (optional)

  parachute:
    enabled: true
    name: "Main"
    cd_s: 10.0  # Drag coefficient × area (m²)
    trigger: "apogee"  # "apogee" or altitude in meters (e.g., 800)
    sampling_rate_hz: 105.0
    lag_s: 1.5  # Deployment lag time
    noise_std: [0, 8.3, 0.5]  # [x, y, z] noise standard deviations

  #Optional: Custom drag curves (if not provided, uses default Cd calculation)
  power_off_drag: "data/drag_curves/polito_drag_coefficient_power_off.csv"
  power_on_drag: "data/drag_curves/polito_drag_coefficient_power_on.csv"

motor:
  type: "SolidMotor"
  thrust_source: "data/motors/Cesaroni_5472M2250-P.eng"  # Path to thrust curve file

  dry_mass_kg: 1.815
  dry_inertia: [0.125, 0.125, 0.002]  # [Ixx, Iyy, Izz] in kg·m²

  nozzle_radius_m: 0.033
  throat_radius_m: 0.011

  grain_number: 5
  grain_density_kg_m3: 1815.0
  grain_outer_radius_m: 0.033
  grain_initial_inner_radius_m: 0.015
  grain_initial_height_m: 0.120
  grain_separation_m: 0.005

  # ✅ Posizioni corrette nel sistema di riferimento del MOTOR
  # Motor coordinate system: nozzle_to_combustion_chamber
  # Nozzle è all'origine (0), camera di combustione in positivo
  grains_center_of_mass_position_m: 0.317  # ✅ Grains center a ~31 cm dal nozzle
  center_of_dry_mass_position_m: 0.317     # ✅ Dry mass center
  nozzle_position_m: 0.0                   # ✅ Nozzle all'origine del motor

  burn_time_s: null  # Computed from thrust curve if null

  # Advanced parameters
  interpolation_method: "spline"  # Options: linear, spline, akima
  coordinate_system_orientation: "nozzle_to_combustion_chamber"  # nozzle at origin, combustion chamber in positive direction
  reference_pressure: null  # Atmospheric pressure (Pa) at which thrust was recorded

  # ✅ Motor position nel sistema del ROCKET (nose_to_tail)
  # Il nozzle del motor sporge 0.5 m oltre la coda (tail a 2.0 m dal nose)
  position_m: 2.0  # Motor nozzle exit position from nose (2.5 m = 0.5 m beyond tail)

environment:
  latitude_deg: 39.3897
  longitude_deg: -8.2889
  elevation_m: 100.0

  atmospheric_model: "standard_atmosphere"  # Options: standard_atmosphere, custom_atmosphere
  # atmospheric_model_file: "data/atmosphere.nc"  # Required if using custom model

  date: null  # [year, month, day, hour_utc] or null for no specific date
  # date: [2023, 6, 15, 12]

  # NEW: Weather data sources (replaces atmospheric_model for advanced models)
  # weather:
  #   source: "wyoming"  # Options: standard_atmosphere, wyoming, gfs, era5, custom
  #   wyoming_station: "72340"  # Oakland, CA (required for wyoming)
  #   # custom_file: "data/custom_atmosphere.txt"  # Required for custom source
  #   fetch_real_time: false  # Use date vs. latest available

  wind:
    model: "constant"  # Options: constant, from_weather, function, custom
    velocity_ms: 0.0
    direction_deg: 90.0  # Meteorological convention (0=North, 90=East)

  gravity_ms2: 9.80665
  max_expected_height_m: 5000.0

simulation:
  max_time_s: 600.0
  max_time_step_s: .inf  # Use inf for automatic
  min_time_step_s: 0.0
  rtol: 1e-6  # Relative tolerance
  atol: 1e-6  # Absolute tolerance
  terminate_on_apogee: false
  verbose: false

  rail:
    length_m: 1.5 
    inclination_deg: 85.0  # Degrees from vertical (0=horizontal, 90=vertical)
    heading_deg: 0.0  # Degrees from North (0=North, 90=East)


monte_carlo:
  num_simulations: 50
  seed: 42

  variations:
    motor_thrust_std_pct: 5.0  # ±5% thrust variation
    dry_mass_std_kg: 0.5  # ±0.5 kg mass uncertainty
    wind_speed_std_ms: 2.0  # ±2 m/s wind variation
    wind_direction_std_deg: 10.0  # ±10 degrees wind direction variation
